<script>
    function handleFetchError(error) {
        console.error('Fetch error:', error);
        alert('An error occurred. Please try again later.');
    }

    function loadModel() {
        fetch('/load_model', { method: 'POST' })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load model');
                }
                return response.json();
            })
            .then(data => alert(data.message || data.error))
            .catch(handleFetchError);
    }

    function loadClassIndices() {
        fetch('/load_class_indices', { method: 'POST' })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load class indices');
                }
                return response.json();
            })
            .then(data => alert(data.message || data.error))
            .catch(handleFetchError);
    }

    function diagnose() {
        const fileInput = document.getElementById('imageInput');
        if (!fileInput.files.length) {
            alert('Please select an image first.');
            return;
        }

        const formData = new FormData();
        formData.append('image', fileInput.files[0]);

        fetch('/process_image', {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Failed to diagnose image');
            }
            return response.json();
        })
        .then(data => {
            const resultDiv = document.getElementById('result');
            if (data.error) {
                resultDiv.innerHTML = '<div class="result-box">Error: ' + data.error + '</div>';
            } else {
                resultDiv.innerHTML = `
                    <div class="result-box">
                        <p>Class: ${data.class}</p>
                        <p>Percentage Disease: ${data.percentage_disease}%</p>
                        <p>${data.class.includes('healthy') ? 'THE PLANT IS HEALTHY' : 'THE PLANT NEEDS TO BE TREATED'}</p>
                    </div>`;
            }
            resultDiv.style.display = 'block'; // Show the result box
        })
        .catch(handleFetchError);
    }
</script>
